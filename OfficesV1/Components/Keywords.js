function getCache(e,t){try{const r=JSON.parse(localStorage.getItem(e));return t.split(".").reduce(((e,t)=>e?.[t]),r)}catch(r){return void console.warn(`⚠️ Error accediendo a ${e}.${t}`)}}function buildKeywords(){document.querySelectorAll("[cf-keywords-build]").forEach((e=>{const t=e.getAttribute("cf-keywords-build"),r=e.getAttribute("form-path"),o=e.getAttribute("keywords-limit"),n=e.getAttribute("maxlength")||"256",i=e.getAttribute("cf-required"),d=getCache("dynamic","keywords"),a=e.getAttribute("cf-child"),l=e.getAttribute("cf-target"),c=document.getElementById(t);if(!c)return void console.error(`❌ No se encontró template con id="${t}"`);e.style.display="block",e.style.opacity="1",e.style.visibility="visible";const s=c.cloneNode(!0);s.removeAttribute("id"),s.style.display="block",e.appendChild(s);const u=s.querySelector("[words-group]"),y=u.querySelector("[word-button]").cloneNode(!0),p=s.querySelector("[text-field-container]"),b=p.querySelector("[keywords-input]"),g=p.querySelector("[add-button]");u.innerHTML="",b.setAttribute("maxlength",n);const f=document.createElement("input");f.type="hidden",f.setAttribute("cf-json-path",r),f.setAttribute("name",r),f.setAttribute("data-required-message",d),f.setAttribute("cf-options-child",a),f.setAttribute("cf-options-target",l),f.value="[]","true"===i&&f.setAttribute("data-required",""),e.insertBefore(f,s);let m=[];const h=()=>{f.value=JSON.stringify(m),u.innerHTML="",m.forEach(((e,t)=>{const r=y.cloneNode(!0);r.querySelector("[generated-keyword]").textContent=e,r.addEventListener("click",(e=>{e.preventDefault(),m=m.filter(((e,r)=>r!==t)),h()})),u.appendChild(r)}))},v=()=>{const e=b.value.trim();e&&(o&&m.length>=parseInt(o)?showErrorModal(`Máximo ${o} palabras permitidas`):m.includes(e)?showErrorModal("Esta palabra ya fue agregada"):(m.push(e),b.value="",h()))};g.addEventListener("click",(e=>{e.preventDefault(),v()})),b.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),v())})),c.style.display="none",h()})),document.dispatchEvent(new Event("keywords-builder-ready"))}document.addEventListener("data-ready",buildKeywords);