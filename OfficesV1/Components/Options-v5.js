!function(){"use strict";function t(t,e=null){try{return JSON.parse(t)}catch{return e}}function e(t,e){if(t&&e)return e.split(".").reduce(((t,e)=>t&&void 0!==t[e]?t[e]:void 0),t)}const n=new Map;function o(t,e,n,o){const r={componentId:e.componentId,jsonPath:e.jsonPath,type:t,value:o.value,label:o.label,id:o.id,isChecked:o.isChecked,currentValue:o.currentValue};document.dispatchEvent(new CustomEvent("option-change",{detail:r})),"checkbox"===t?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:r})):"radio"===t&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:r}))}function r(t){const e=n.get(t);if(!e||!e.continueButtonId)return;const o=document.getElementById(e.continueButtonId);if(!o)return;const r=e.hiddenEl.value;"[]"===r||"{}"===r||"string"==typeof r&&""===r.trim()?o.classList.add("inutil"):o.classList.remove("inutil")}document.addEventListener("data-ready",(function(){document.querySelectorAll("[component-id]").forEach((i=>{try{!function(i){const c=i.getAttribute("component-id"),l=i.getAttribute("storage-key"),a=i.getAttribute("storage-path"),s=i.getAttribute("json-path"),u=i.getAttribute("parent")||"",d="true"===i.getAttribute("has-deps"),p=i.getAttribute("value-key"),g=i.getAttribute("label-key"),b=i.getAttribute("tag-key"),h=i.getAttribute("id-key"),f=i.getAttribute("click-key")||"",y=i.getAttribute("f-class")||"",v=i.getAttribute("l-class")||"",m=i.getAttribute("continue-button-id")||null,A=i.getAttribute("checkbox-limit")?parseInt(i.getAttribute("checkbox-limit")):null,S=(i.getAttribute("input-type")||"checkbox").toLowerCase(),k=i.getAttribute("group-component-id")||c;if(!(c&&l&&a&&s&&p&&g))return void console.error(`component "${c}": faltan atributos requeridos.`);const E=i.querySelector('[role="group"]');if(!E)return void console.error(`component "${c}": falta elemento con role="group".`);const C=i.querySelector("[c-field]");if(!C)return void console.error(`component "${c}": falta plantilla [c-field].`);const q=t(localStorage.getItem(l),null);if(!q)return void console.warn(`component "${c}": no hay datos válidos en localStorage["${l}"].`);const L=e(q,`${a}.options`);if(!Array.isArray(L)||0===L.length)return void console.warn(`component "${c}": no se encontró ${a}.options o está vacío.`);let x=i.querySelector(`input[type="hidden"][cf-json-path="${s}"]`);x||(x=document.createElement("input"),x.type="hidden",x.setAttribute("cf-json-path",s),x.name=s,i.appendChild(x));if(u)x.removeAttribute("data-required");else{x.setAttribute("data-required","");const t=e(q,`${a}.message`)||"Selecciona una opción";x.setAttribute("data-required-message",t)}x.value="checkbox"===S?x.value||"[]":x.value||"{}";for(;E.firstChild;)E.removeChild(E.firstChild);L.forEach((t=>{const e=C.cloneNode(!0),n=e.querySelector("[c-tag]"),o=e.querySelector("[c-label]"),r=e.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),i=String(t[g]??""),l=String(t[b]??"").trim(),a=String(t[p]??""),s=h&&void 0!==t[h]?String(t[h]):null,u=f&&void 0!==t[f]?String(t[f]):null;o&&(o.textContent=i),n&&(l?(n.textContent=l,n.style.display=""):(n.textContent="",n.style.display="none")),r?(r.type=S,r.setAttribute("data-opt-value",a),r.setAttribute("data-opt-label",i),s&&r.setAttribute("data-opt-id",s),l&&r.setAttribute("data-opt-tag",l),u&&r.setAttribute("data-opt-click",u),"radio"===S&&(r.name=k)):console.warn(`component "${c}": clone c-field no contiene native-button ni input detectable.`),u&&e.setAttribute("cl",u),E.appendChild(e)})),E._hasDelegate||(E.addEventListener("change",(e=>function(e,i){const c=e.target;if(!(c&&c instanceof HTMLInputElement))return;const l=n.get(i);if(!l)return;const{inputType:a,hiddenEl:s,checkboxLimit:u,fClass:d,lClass:p,groupEl:g}=l,b=c.getAttribute("data-opt-value"),h=c.getAttribute("data-opt-label")||"",f=c.getAttribute("data-opt-id")||null,y=c.checked;if("checkbox"===a){let e=t(s.value,[]);e=Array.isArray(e)?e:[];const n=e.some((t=>String(t.value)===String(b)));if(y&&!n){if(u&&e.length>=u)return v=`Selecciona máximo ${u} opciones.`,"function"==typeof showToast?showToast(v,"error"):"function"==typeof alert?alert(v):console.error(v),void(c.checked=!1);const t={value:b,label:h};f&&(t.id=f),e.push(t)}else!y&&n&&(e=e.filter((t=>String(t.value)!==String(b))));const r=c.closest("[c-field]");r&&d&&r.classList.toggle(d,y);const i=r&&r.querySelector("[c-label]");i&&p&&i.classList.toggle(p,y),s.value=JSON.stringify(e),l.currentValue=e.slice(),o("checkbox",l,c,{value:b,label:h,id:f,isChecked:y,currentValue:e})}else if("radio"===a){const t={value:b,label:h};f&&(t.id=f),g.querySelectorAll("[c-field]").forEach((t=>{d&&t.classList.remove(d);const e=t.querySelector("[c-label]");e&&p&&e.classList.remove(p)}));const e=c.closest("[c-field]");e&&d&&e.classList.add(d);const n=e&&e.querySelector("[c-label]");n&&p&&n.classList.add(p),s.value=JSON.stringify(t),l.currentValue=Object.assign({},t),o("radio",l,c,{value:b,label:h,id:f,isChecked:!0,currentValue:l.currentValue})}var v;r(i)}(e,c))),E._hasDelegate=!0);n.set(c,{componentId:c,componentEl:i,storageKey:l,storagePath:a,jsonPath:s,parent:u,hasDeps:d,valueKey:p,labelKey:g,tagKey:b,idKey:h,clickKey:f,fClass:y,lClass:v,continueButtonId:m,checkboxLimit:A,inputType:S,groupEl:E,fieldTemplate:C,hiddenEl:x,currentValue:"checkbox"===S?[]:{}}),function(e){const o=n.get(e);if(!o)return;const{hiddenEl:r,inputType:i,groupEl:c,fClass:l,lClass:a}=o,s=r.value;if(!s)return;const u=t(s,null);c.querySelectorAll("[c-field]").forEach((t=>{l&&t.classList.remove(l);const e=t.querySelector("[c-label]");e&&a&&e.classList.remove(a);const n=t.querySelector("[native-button], input");n&&(n.checked=!1)})),"checkbox"===i&&Array.isArray(u)?(u.forEach((t=>{c.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(t.value)){e.checked=!0;const t=e.closest("[c-field]");t&&l&&t.classList.add(l);const n=t&&t.querySelector("[c-label]");n&&a&&n.classList.add(a)}}))})),o.currentValue=u.slice()):"radio"===i&&u&&"object"==typeof u&&Object.keys(u).length?(c.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(u.value)){t.checked=!0;const e=t.closest("[c-field]");e&&l&&e.classList.add(l);const n=e&&e.querySelector("[c-label]");n&&a&&n.classList.add(a)}})),o.currentValue=u):o.currentValue="checkbox"===i?[]:{}}(c),r(c)}(i)}catch(t){console.error("Error building component",i.getAttribute("component-id"),t)}})),document.dispatchEvent(new Event("options-builder-ready"))})),window.__OptionsBuilder={COMPONENTS:n}}();