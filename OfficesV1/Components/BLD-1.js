!function(){"use strict";function e(e,t=null){try{return JSON.parse(e)}catch{return t}}const t=new Map;function n(e,t,n,o){const l={componentId:t.componentId,jsonPath:t.jsonPath,type:e,value:o.value,label:o.label,id:o.id,isChecked:o.isChecked,currentValue:o.currentValue,dependencies:t.dependencies};document.dispatchEvent(new CustomEvent("option-change",{detail:l})),"checkbox"===e?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:l})):"radio"===e&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:l}))}document.addEventListener("data-ready",(function(){document.querySelectorAll("[component-id]").forEach((o=>{try{!function(o){const l=o.getAttribute("component-id"),i=o.getAttribute("storage-key")||null,r=o.getAttribute("storage-path")||"",c=o.getAttribute("json-path")||"",a="true"===String(o.getAttribute("dependencies")||"").toLowerCase(),s=o.getAttribute("value-key")||"value",u=o.getAttribute("label-key")||"label",d=o.getAttribute("tag-key")||"tag",p=o.getAttribute("id-key")||null,g=o.getAttribute("click-key")||null,b=o.getAttribute("f-class")||"",h=o.getAttribute("l-class")||"",y=o.getAttribute("continue-button-id")||null,f=o.getAttribute("checkbox-limit")?parseInt(o.getAttribute("checkbox-limit")):null,v=(o.getAttribute("input-type")||"checkbox").toLowerCase(),m=o.getAttribute("group-component-id")||l;if(!l||!c)return void console.error(`BuildOptions: component "${l}": faltan atributos mínimos (component-id, json-path).`);const A=o.querySelector('[role="group"]');if(!A)return void console.error(`BuildOptions: component "${l}": falta elemento con role="group".`);const S=o.querySelector("[c-field]");if(!S)return void console.error(`BuildOptions: component "${l}": falta plantilla [c-field].`);let k=null;if(i){const t=e(localStorage.getItem(i),null);t?r?k=function(e,t){if(e&&t)return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e)}(t,`${r}.options`):Array.isArray(t)?k=t:Array.isArray(t.options)&&(k=t.options):console.warn(`BuildOptions: component "${l}": no hay datos válidos en localStorage["${i}"].`)}Array.isArray(k)&&0!==k.length||(k=[]);let E=o.querySelector(`input[type="hidden"][cf-json-path="${c}"]`);E||(E=document.createElement("input"),E.type="hidden",E.setAttribute("cf-json-path",c),E.name=c,o.appendChild(E));y&&E.setAttribute("continue-trigger",y);E.value="checkbox"===v?E.value||"[]":E.value||"{}";for(;A.firstChild;)A.removeChild(A.firstChild);k.length&&k.forEach((e=>{const t=S.cloneNode(!0),n=t.querySelector("[c-tag]"),o=t.querySelector("[c-label]"),i=t.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),r=String(e[u]??""),c=String(e[d]??"").trim(),a=String(e[s]??""),b=p&&void 0!==e[p]?String(e[p]):null,h=g&&void 0!==e[g]?String(e[g]):null;o&&(o.textContent=r),n&&(c?(n.textContent=c,n.style.display=""):(n.textContent="",n.style.display="none")),i?(i.type=v,i.setAttribute("data-opt-value",a),i.setAttribute("data-opt-label",r),b&&i.setAttribute("data-opt-id",b),c&&i.setAttribute("data-opt-tag",c),h&&i.setAttribute("data-opt-click",h),"radio"===v&&(i.name=m)):console.warn(`BuildOptions: component "${l}": clone c-field no contiene native-button ni input detectable.`),h&&t.setAttribute("cl",h),A.appendChild(t)}));A._hasDelegate||(A.addEventListener("change",(o=>function(o,l){const i=o.target;if(!(i&&i instanceof HTMLInputElement))return;const r=t.get(l);if(!r)return;const{inputType:c,hiddenEl:a,checkboxLimit:s,fClass:u,lClass:d,groupEl:p,dependencies:g}=r,b=i.getAttribute("data-opt-value"),h=i.getAttribute("data-opt-label")||"",y=i.getAttribute("data-opt-id")||null,f=i.checked;if("checkbox"===c){let t=e(a.value,[]);t=Array.isArray(t)?t:[];const o=t.some((e=>String(e.value)===String(b)));if(f&&!o){if(s&&t.length>=s)return v=`Selecciona máximo ${s} opciones.`,"function"==typeof showToast?showToast(v,"error"):"function"==typeof alert?alert(v):console.error(v),void(i.checked=!1);const e={value:b,label:h};y&&(e.id=y),t.push(e)}else!f&&o&&(t=t.filter((e=>String(e.value)!==String(b))));const l=i.closest("[c-field]");l&&u&&l.classList.toggle(u,f);const c=l&&l.querySelector("[c-label]");c&&d&&c.classList.toggle(d,f),a.value=JSON.stringify(t),r.currentValue=t.slice(),n("checkbox",r,i,{value:b,label:h,id:y,isChecked:f,currentValue:t})}else if("radio"===c){const e={value:b,label:h};y&&(e.id=y),p.querySelectorAll("[c-field]").forEach((e=>{u&&e.classList.remove(u);const t=e.querySelector("[c-label]");t&&d&&t.classList.remove(d)}));const t=i.closest("[c-field]");t&&u&&t.classList.add(u);const o=t&&t.querySelector("[c-label]");o&&d&&o.classList.add(d),a.value=JSON.stringify(e),r.currentValue=Object.assign({},e),n("radio",r,i,{value:b,label:h,id:y,isChecked:!0,currentValue:r.currentValue})}var v}(o,l))),A._hasDelegate=!0);t.set(l,{componentId:l,componentEl:o,storageKey:i,storagePath:r,jsonPath:c,dependencies:a,valueKey:s,labelKey:u,tagKey:d,idKey:p,clickKey:g,fClass:b,lClass:h,continueButtonId:y,checkboxLimit:f,inputType:v,groupEl:A,fieldTemplate:S,hiddenEl:E,currentValue:"checkbox"===v?[]:{}}),function(n){const o=t.get(n);if(!o)return;const{hiddenEl:l,inputType:i,groupEl:r,fClass:c,lClass:a}=o,s=l.value;if(null==s)return;const u=e(s,null);r.querySelectorAll("[c-field]").forEach((e=>{c&&e.classList.remove(c);const t=e.querySelector("[c-label]");t&&a&&t.classList.remove(a);const n=e.querySelector("[native-button], input");n&&(n.checked=!1)})),"checkbox"===i&&Array.isArray(u)?(u.forEach((e=>{r.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(e.value)){t.checked=!0;const e=t.closest("[c-field]");e&&c&&e.classList.add(c);const n=e&&e.querySelector("[c-label]");n&&a&&n.classList.add(a)}}))})),o.currentValue=u.slice()):"radio"===i&&u&&"object"==typeof u&&Object.keys(u).length?(r.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(u.value)){e.checked=!0;const t=e.closest("[c-field]");t&&c&&t.classList.add(c);const n=t&&t.querySelector("[c-label]");n&&a&&n.classList.add(a)}})),o.currentValue=u):o.currentValue="checkbox"===i?[]:{}}(l)}(o)}catch(e){console.error("BuildOptions: Error building component",o.getAttribute("component-id"),e)}})),document.dispatchEvent(new Event("options-builder-ready"))})),window.__OptionsBuilder={COMPONENTS:t}}();