!function(){"use strict";function e(e,t=null){try{return JSON.parse(e)}catch{return t}}function t(e,t){if(e&&t)return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e)}const o=new Map;function n(e,t,o,n){const r={componentId:t.componentId,jsonPath:t.jsonPath,type:e,value:n.value,label:n.label,id:n.id,isChecked:n.isChecked,currentValue:n.currentValue};document.dispatchEvent(new CustomEvent("option-change",{detail:r})),"checkbox"===e?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:r})):"radio"===e&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:r}))}document.addEventListener("data-ready",(function(){document.querySelectorAll("[component-id]").forEach((r=>{try{!function(r){const i=r.getAttribute("component-id"),l=r.getAttribute("storage-key"),c=r.getAttribute("storage-path"),a=r.getAttribute("json-path"),u=r.getAttribute("parent")||"",s="true"===r.getAttribute("has-deps"),d=r.getAttribute("value-key"),p=r.getAttribute("label-key"),b=r.getAttribute("tag-key"),g=r.getAttribute("id-key"),h=r.getAttribute("click-key")||"",f=r.getAttribute("f-class")||"",y=r.getAttribute("l-class")||"",v=r.getAttribute("continue-button-id")||null,m=r.getAttribute("checkbox-limit")?parseInt(r.getAttribute("checkbox-limit")):null,A=(r.getAttribute("input-type")||"checkbox").toLowerCase(),S=r.getAttribute("group-component-id")||i;if(!(i&&l&&c&&a&&d&&p))return void console.error(`component "${i}": faltan atributos requeridos.`);const k=r.querySelector('[role="group"]');if(!k)return void console.error(`component "${i}": falta elemento con role="group".`);const E=r.querySelector("[c-field]");if(!E)return void console.error(`component "${i}": falta plantilla [c-field].`);const C=e(localStorage.getItem(l),null);if(!C)return void console.warn(`component "${i}": no hay datos válidos en localStorage["${l}"].`);const q=t(C,`${c}.options`);if(!Array.isArray(q)||0===q.length)return void console.warn(`component "${i}": no se encontró ${c}.options o está vacío.`);let x=r.querySelector(`input[type="hidden"][cf-json-path="${a}"]`);x||(x=document.createElement("input"),x.type="hidden",x.setAttribute("cf-json-path",a),x.name=a,r.appendChild(x));null!=v&&x.setAttribute("continue-trigger",v);if(u)x.removeAttribute("data-required");else{x.setAttribute("data-required","");const e=t(C,`${c}.message`)||"Selecciona una opción";x.setAttribute("data-required-message",e)}x.value="checkbox"===A?x.value||"[]":x.value||"{}";for(;k.firstChild;)k.removeChild(k.firstChild);q.forEach((e=>{const t=E.cloneNode(!0),o=t.querySelector("[c-tag]"),n=t.querySelector("[c-label]"),r=t.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),l=String(e[p]??""),c=String(e[b]??"").trim(),a=String(e[d]??""),u=g&&void 0!==e[g]?String(e[g]):null,s=h&&void 0!==e[h]?String(e[h]):null;n&&(n.textContent=l),o&&(c?(o.textContent=c,o.style.display=""):(o.textContent="",o.style.display="none")),r?(r.type=A,r.setAttribute("data-opt-value",a),r.setAttribute("data-opt-label",l),u&&r.setAttribute("data-opt-id",u),c&&r.setAttribute("data-opt-tag",c),s&&r.setAttribute("data-opt-click",s),"radio"===A&&(r.name=S)):console.warn(`component "${i}": clone c-field no contiene native-button ni input detectable.`),s&&t.setAttribute("cl",s),k.appendChild(t)})),k._hasDelegate||(k.addEventListener("change",(t=>function(t,r){const i=t.target;if(!(i&&i instanceof HTMLInputElement))return;const l=o.get(r);if(!l)return;const{inputType:c,hiddenEl:a,checkboxLimit:u,fClass:s,lClass:d,groupEl:p}=l,b=i.getAttribute("data-opt-value"),g=i.getAttribute("data-opt-label")||"",h=i.getAttribute("data-opt-id")||null,f=i.checked;if("checkbox"===c){let t=e(a.value,[]);t=Array.isArray(t)?t:[];const o=t.some((e=>String(e.value)===String(b)));if(f&&!o){if(u&&t.length>=u)return y=`Selecciona máximo ${u} opciones.`,"function"==typeof showToast?showToast(y,"error"):"function"==typeof alert?alert(y):console.error(y),void(i.checked=!1);const e={value:b,label:g};h&&(e.id=h),t.push(e)}else!f&&o&&(t=t.filter((e=>String(e.value)!==String(b))));const r=i.closest("[c-field]");r&&s&&r.classList.toggle(s,f);const c=r&&r.querySelector("[c-label]");c&&d&&c.classList.toggle(d,f),a.value=JSON.stringify(t),l.currentValue=t.slice(),n("checkbox",l,i,{value:b,label:g,id:h,isChecked:f,currentValue:t})}else if("radio"===c){const e={value:b,label:g};h&&(e.id=h),p.querySelectorAll("[c-field]").forEach((e=>{s&&e.classList.remove(s);const t=e.querySelector("[c-label]");t&&d&&t.classList.remove(d)}));const t=i.closest("[c-field]");t&&s&&t.classList.add(s);const o=t&&t.querySelector("[c-label]");o&&d&&o.classList.add(d),a.value=JSON.stringify(e),l.currentValue=Object.assign({},e),n("radio",l,i,{value:b,label:g,id:h,isChecked:!0,currentValue:l.currentValue})}var y;updateContinueButton(r)}(t,i))),k._hasDelegate=!0);o.set(i,{componentId:i,componentEl:r,storageKey:l,storagePath:c,jsonPath:a,parent:u,hasDeps:s,valueKey:d,labelKey:p,tagKey:b,idKey:g,clickKey:h,fClass:f,lClass:y,checkboxLimit:m,inputType:A,groupEl:k,fieldTemplate:E,hiddenEl:x,currentValue:"checkbox"===A?[]:{}}),function(t){const n=o.get(t);if(!n)return;const{hiddenEl:r,inputType:i,groupEl:l,fClass:c,lClass:a}=n,u=r.value;if(!u)return;const s=e(u,null);l.querySelectorAll("[c-field]").forEach((e=>{c&&e.classList.remove(c);const t=e.querySelector("[c-label]");t&&a&&t.classList.remove(a);const o=e.querySelector("[native-button], input");o&&(o.checked=!1)})),"checkbox"===i&&Array.isArray(s)?(s.forEach((e=>{l.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(e.value)){t.checked=!0;const e=t.closest("[c-field]");e&&c&&e.classList.add(c);const o=e&&e.querySelector("[c-label]");o&&a&&o.classList.add(a)}}))})),n.currentValue=s.slice()):"radio"===i&&s&&"object"==typeof s&&Object.keys(s).length?(l.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(s.value)){e.checked=!0;const t=e.closest("[c-field]");t&&c&&t.classList.add(c);const o=t&&t.querySelector("[c-label]");o&&a&&o.classList.add(a)}})),n.currentValue=s):n.currentValue="checkbox"===i?[]:{}}(i),updateContinueButton(i)}(r)}catch(e){console.error("Error building component",r.getAttribute("component-id"),e)}})),document.dispatchEvent(new Event("options-builder-ready"))})),window.__OptionsBuilder={COMPONENTS:o}}();