!function(){"use strict";function e(e,t=null){try{return JSON.parse(e)}catch{return t}}const t=new Map;function n(e,t,n,o){const i={componentId:t.componentId,jsonPath:t.jsonPath,type:e,value:o.value,label:o.label,id:o.id,isChecked:o.isChecked,currentValue:o.currentValue,alwaysRequired:t.alwaysRequired,dependencies:t.dependencies,requiredDepend:t.requiredDepend,displayDepend:t.displayDepend,continueButtonId:t.continueButtonId,match:t.MATCH};console.group(`ðŸ“¤ Emitiendo evento de opciÃ³n (${e})`),console.table(i),console.groupEnd(),document.dispatchEvent(new CustomEvent("option-change",{detail:i})),"checkbox"===e?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:i})):"radio"===e&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:i}))}document.addEventListener("data-ready",(function(){document.querySelectorAll("[component-id]").forEach((o=>{try{!function(o){const i=o.getAttribute("component-id"),l=o.getAttribute("storage-key")||null,r=o.getAttribute("storage-path")||"",c=o.getAttribute("json-path")||"",a="true"===String(o.getAttribute("dependencies")||"").toLowerCase(),u=o.getAttribute("value-key")||"value",s=o.getAttribute("label-key")||"label",d=o.getAttribute("tag-key")||"tag",p=o.getAttribute("id-key")||"id",g=o.getAttribute("click-key")||null,b=o.getAttribute("f-class")||"",y=o.getAttribute("l-class")||"",h=o.getAttribute("continue-button-id")||null,f=o.getAttribute("checkbox-limit")?parseInt(o.getAttribute("checkbox-limit")):null,v=(o.getAttribute("input-type")||"checkbox").toLowerCase(),A=o.getAttribute("group-component-id")||i,m="true"===String(o.getAttribute("always-required")).trim().toLowerCase(),S=o.getAttribute("required-depend")||null,k=o.getAttribute("display-depend")||null,E=o.getAttribute("match")||null;if(!i||!c)return void console.error(`BuildOptions: component "${i}": faltan atributos mÃ­nimos (component-id, json-path).`);const q=o.querySelector('[role="group"]');if(!q)return void console.error(`BuildOptions: component "${i}": falta elemento con role="group".`);const C=o.querySelector("[c-field]");if(!C)return void console.error(`BuildOptions: component "${i}": falta plantilla [c-field].`);let L=null;if(l){const t=e(localStorage.getItem(l),null);t?r?L=function(e,t){if(e&&t)return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e)}(t,`${r}.options`):Array.isArray(t)?L=t:Array.isArray(t.options)&&(L=t.options):console.warn(`BuildOptions: component "${i}": no hay datos vÃ¡lidos en localStorage["${l}"].`)}Array.isArray(L)&&0!==L.length||(L=[]);let w=o.querySelector(`input[type="hidden"][cf-json-path="${c}"]`);w||(w=document.createElement("input"),w.type="hidden",w.setAttribute("cf-json-path",c),w.name=c,o.appendChild(w));m&&(w.setAttribute("data-required",""),w.setAttribute("always-required",""));h&&w.setAttribute("continue-trigger",h);w.value="checkbox"===v?w.value||"[]":w.value||"{}";for(;q.firstChild;)q.removeChild(q.firstChild);L.length&&L.forEach((e=>{const t=C.cloneNode(!0),n=t.querySelector("[c-tag]"),o=t.querySelector("[c-label]"),l=t.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),r=String(e[s]??""),c=String(e[d]??"").trim(),a=String(e[u]??""),b=p&&void 0!==e[p]?String(e[p]):null,y=g&&void 0!==e[g]?String(e[g]):null;o&&(o.textContent=r),n&&(c?(n.textContent=c,n.style.display=""):(n.textContent="",n.style.display="none")),l?(l.type=v,l.setAttribute("data-opt-value",a),l.setAttribute("data-opt-label",r),b&&l.setAttribute("data-opt-id",b),c&&l.setAttribute("data-opt-tag",c),y&&l.setAttribute("data-opt-click",y),"radio"===v&&(l.name=A)):console.warn(`BuildOptions: component "${i}": clone c-field no contiene native-button ni input detectable.`),y&&t.setAttribute("cl",y),q.appendChild(t)}));q._hasDelegate||(q.addEventListener("change",(o=>function(o,i){const l=o.target;if(!(l&&l instanceof HTMLInputElement))return;const r=t.get(i);if(!r)return;const{inputType:c,hiddenEl:a,checkboxLimit:u,fClass:s,lClass:d,groupEl:p,dependencies:g}=r,b=l.getAttribute("data-opt-value"),y=l.getAttribute("data-opt-label")||"",h=l.getAttribute("data-opt-id")||null,f=l.checked;if("checkbox"===c){let t=e(a.value,[]);t=Array.isArray(t)?t:[];const o=t.some((e=>String(e.value)===String(b)));if(f&&!o){if(u&&t.length>=u)return v=`Selecciona mÃ¡ximo ${u} opciones.`,"function"==typeof showToast?showToast(v,"error"):"function"==typeof alert?alert(v):console.error(v),void(l.checked=!1);const e={value:b,label:y};h&&(e.id=h),t.push(e)}else!f&&o&&(t=t.filter((e=>String(e.value)!==String(b))));const i=l.closest("[c-field]");i&&s&&i.classList.toggle(s,f);const c=i&&i.querySelector("[c-label]");c&&d&&c.classList.toggle(d,f),a.value=JSON.stringify(t),r.currentValue=t.slice(),n("checkbox",r,l,{value:b,label:y,id:h,isChecked:f,currentValue:t})}else if("radio"===c){const e={value:b,label:y};h&&(e.id=h),p.querySelectorAll("[c-field]").forEach((e=>{s&&e.classList.remove(s);const t=e.querySelector("[c-label]");t&&d&&t.classList.remove(d)}));const t=l.closest("[c-field]");t&&s&&t.classList.add(s);const o=t&&t.querySelector("[c-label]");o&&d&&o.classList.add(d),a.value=JSON.stringify(e),r.currentValue=Object.assign({},e),n("radio",r,l,{value:b,label:y,id:h,isChecked:!0,currentValue:r.currentValue})}var v}(o,i))),q._hasDelegate=!0);t.set(i,{componentId:i,componentEl:o,storageKey:l,storagePath:r,jsonPath:c,dependencies:a,valueKey:u,labelKey:s,tagKey:d,idKey:p,clickKey:g,fClass:b,lClass:y,continueButtonId:h,checkboxLimit:f,inputType:v,groupEl:q,fieldTemplate:C,hiddenEl:w,alwaysRequired:m,displayDepend:k,requiredDepend:S,MATCH:E,currentValue:"checkbox"===v?[]:{}}),function(n){const o=t.get(n);if(!o)return;const{hiddenEl:i,inputType:l,groupEl:r,fClass:c,lClass:a}=o,u=i.value;if(null==u)return;const s=e(u,null);r.querySelectorAll("[c-field]").forEach((e=>{c&&e.classList.remove(c);const t=e.querySelector("[c-label]");t&&a&&t.classList.remove(a);const n=e.querySelector("[native-button], input");n&&(n.checked=!1)})),"checkbox"===l&&Array.isArray(s)?(s.forEach((e=>{r.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(e.value)){t.checked=!0;const e=t.closest("[c-field]");e&&c&&e.classList.add(c);const n=e&&e.querySelector("[c-label]");n&&a&&n.classList.add(a)}}))})),o.currentValue=s.slice()):"radio"===l&&s&&"object"==typeof s&&Object.keys(s).length?(r.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(s.value)){e.checked=!0;const t=e.closest("[c-field]");t&&c&&t.classList.add(c);const n=t&&t.querySelector("[c-label]");n&&a&&n.classList.add(a)}})),o.currentValue=s):o.currentValue="checkbox"===l?[]:{}}(i)}(o)}catch(e){console.error("BuildOptions: Error building component",o.getAttribute("component-id"),e)}})),document.dispatchEvent(new Event("options-builder-ready"))})),window.__OptionsBuilder={COMPONENTS:t}}();