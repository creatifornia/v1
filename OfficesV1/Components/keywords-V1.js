function getCache(e,t){try{const r=JSON.parse(localStorage.getItem(e));return t.split(".").reduce(((e,t)=>e?.[t]),r)}catch(r){return void console.warn(`⚠️ Error accediendo a ${e}.${t}`)}}function buildKeywords(){document.querySelectorAll("[cf-keywords-build]").forEach((e=>{const t=e.getAttribute("cf-keywords-build"),r=e.getAttribute("form-path"),n=e.getAttribute("keywords-limit"),o=e.getAttribute("maxlength")||"256",d=e.getAttribute("cf-required"),i=getCache("dynamic","keywords"),l=getCache("dynamic","keywords-repeated"),a=getCache("dynamic","keywords-limit"),c=document.getElementById(t);if(!c)return void console.error(`❌ No se encontró template con id="${t}"`);e.style.display="block",e.style.opacity="1",e.style.visibility="visible";const s=c.cloneNode(!0);s.removeAttribute("id"),s.style.display="block",e.appendChild(s);const u=s.querySelector("[words-group]"),y=u.querySelector("[word-button]").cloneNode(!0),p=s.querySelector("[text-field-container]"),b=p.querySelector("[keywords-input]"),m=p.querySelector("[add-button]");u.innerHTML="",b.setAttribute("maxlength",o);const g=document.createElement("input");g.type="hidden",g.setAttribute("cf-json-path",r),g.setAttribute("name",r),g.setAttribute("data-required-message",i),g.value="[]","true"===d&&(g.setAttribute("data-required",""),g.setAttribute("always-required","")),e.insertBefore(g,s);let h=[];const v=()=>{g.value=JSON.stringify(h),u.innerHTML="",h.forEach(((e,t)=>{const r=y.cloneNode(!0);r.querySelector("[generated-keyword]").textContent=e,r.addEventListener("click",(e=>{e.preventDefault(),h=h.filter(((e,r)=>r!==t)),v()})),u.appendChild(r)}))},w=()=>{const e=b.value.trim();e&&(n&&h.length>=parseInt(n)?showErrorModal(`${a} ${n}.`):h.includes(e)?showErrorModal(l):(h.push(e),b.value="",v()))};m.addEventListener("click",(e=>{e.preventDefault(),w()})),b.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),w())})),c.style.display="none",v()})),document.dispatchEvent(new Event("keywords-builder-ready"))}document.addEventListener("data-ready",buildKeywords);