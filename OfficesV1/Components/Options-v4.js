!function(){"use strict";function t(t,e=null){try{return JSON.parse(t)}catch{return e}}function e(t,e){if(t&&e)return e.split(".").reduce(((t,e)=>t&&void 0!==t[e]?t[e]:void 0),t)}const n=new Map;function o(){document.querySelectorAll("[component-id]").forEach((o=>{try{!function(o){const c=o.getAttribute("component-id"),l=o.getAttribute("storage-key"),a=o.getAttribute("storage-path"),s=o.getAttribute("json-path"),u=o.getAttribute("parent")||"",d="true"===o.getAttribute("has-deps"),p=o.getAttribute("value-key"),g=o.getAttribute("label-key"),b=o.getAttribute("tag-key"),h=o.getAttribute("id-key"),f=o.getAttribute("click-key"),y=o.getAttribute("f-class")||"",v=o.getAttribute("l-class")||"",m=o.getAttribute("continue-button-id")||null,A=o.getAttribute("checkbox-limit")?parseInt(o.getAttribute("checkbox-limit")):null,S=(o.getAttribute("input-type")||"checkbox").toLowerCase(),k=o.getAttribute("group-component-id")||c;if(!(c&&l&&a&&s&&p&&g))return void console.error(`component "${c}": faltan atributos requeridos.`);const E=o.querySelector('[role="group"]');if(!E)return void console.error(`component "${c}": falta elemento con role="group".`);const C=o.querySelector("[c-field]");if(!C)return void console.error(`component "${c}": falta plantilla [c-field].`);const q=t(localStorage.getItem(l),null);if(!q)return void console.warn(`component "${c}": no hay datos válidos en localStorage["${l}"].`);const L=e(q,`${a}.options`);if(!Array.isArray(L)||0===L.length)return void console.warn(`component "${c}": no se encontró ${a}.options o está vacío.`);let x=o.querySelector(`input[type="hidden"][cf-json-path="${s}"]`);x||(x=document.createElement("input"),x.type="hidden",x.setAttribute("cf-json-path",s),x.name=s,o.appendChild(x));if(u)x.removeAttribute("data-required");else{x.setAttribute("data-required","");const t=e(q,`${a}.message`)||"Selecciona una opción";x.setAttribute("data-required-message",t)}x.value="checkbox"===S?x.value||"[]":x.value||"{}";for(;E.firstChild;)E.removeChild(E.firstChild);L.forEach((t=>{const e=C.cloneNode(!0),n=e.querySelector("[c-tag]"),o=e.querySelector("[c-label]"),r=e.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),i=String(t[g]??""),l=String(t[b]??"").trim(),a=String(t[p]??""),s=h&&void 0!==t[h]?String(t[h]):null,u=f&&void 0!==t[f]?String(t[f]):null;o&&(o.textContent=i),n&&(l?(n.textContent=l,n.style.display=""):(n.textContent="",n.style.display="none")),r?(r.type=S,r.setAttribute("data-opt-value",a),r.setAttribute("data-opt-label",i),s&&r.setAttribute("data-opt-id",s),l&&r.setAttribute("data-opt-tag",l),u&&r.setAttribute("data-opt-click",u),"radio"===S&&(r.name=k)):console.warn(`component "${c}": clone c-field no contiene native-button ni input detectable.`),u&&e.setAttribute("cl",u),E.appendChild(e)})),E._hasDelegate||(E.addEventListener("change",(t=>function(t,e){const o=t.target;if(!(o&&o instanceof HTMLInputElement))return;const c=n.get(e);if(!c)return;const{inputType:l,hiddenEl:a,checkboxLimit:s,fClass:u,lClass:d,groupEl:p}=c,g=o.getAttribute("data-opt-value"),b=o.getAttribute("data-opt-label")||"",h=o.getAttribute("data-opt-id")||null,f=o.checked;if("checkbox"===l){let t=[];try{t=JSON.parse(a.value||"[]")}catch{t=[]}t=Array.isArray(t)?t:[];const e=t.some((t=>String(t.value)===String(g)));if(f&&!e){if(s&&t.length>=s)return y=`Selecciona máximo ${s} opciones.`,"function"==typeof showToast?showToast(y,"error"):"function"==typeof alert?alert(y):console.error(y),void(o.checked=!1);const e={value:g,label:b};h&&(e.id=h),t.push(e)}else!f&&e&&(t=t.filter((t=>String(t.value)!==String(g))));const n=o.closest("[c-field]");n&&u&&n.classList.toggle(u,f);const i=n&&n.querySelector("[c-label]");i&&d&&i.classList.toggle(d,f),a.value=JSON.stringify(t),c.currentValue=t.slice(),r("checkbox",c,o,{value:g,label:b,id:h,isChecked:f,currentValue:t})}else if("radio"===l){const t={value:g,label:b};h&&(t.id=h),p.querySelectorAll("[c-field]").forEach((t=>{u&&t.classList.remove(u);const e=t.querySelector("[c-label]");e&&d&&e.classList.remove(d)}));const e=o.closest("[c-field]");e&&u&&e.classList.add(u);const n=e&&e.querySelector("[c-label]");n&&d&&n.classList.add(d),a.value=JSON.stringify(t),c.currentValue=Object.assign({},t),r("radio",c,o,{value:g,label:b,id:h,isChecked:!0,currentValue:c.currentValue})}var y;i(e)}(t,c))),E._hasDelegate=!0);n.set(c,{componentId:c,componentEl:o,storageKey:l,storagePath:a,jsonPath:s,parent:u,hasDeps:d,valueKey:p,labelKey:g,tagKey:b,idKey:h,clickKey:f,fClass:y,lClass:v,continueButtonId:m,checkboxLimit:A,inputType:S,groupEl:E,fieldTemplate:C,hiddenEl:x,currentValue:"checkbox"===S?[]:{}}),function(e){const o=n.get(e);if(!o)return;const{hiddenEl:r,inputType:i,groupEl:c,fClass:l,lClass:a}=o,s=r.value;if(!s)return;const u=t(s,null);c.querySelectorAll("[c-field]").forEach((t=>{l&&t.classList.remove(l);const e=t.querySelector("[c-label]");e&&a&&e.classList.remove(a);const n=t.querySelector("[native-button], input");n&&(n.checked=!1)})),"checkbox"===i&&Array.isArray(u)?(u.forEach((t=>{c.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(t.value)){e.checked=!0;const t=e.closest("[c-field]");t&&l&&t.classList.add(l);const n=t&&t.querySelector("[c-label]");n&&a&&n.classList.add(a)}}))})),o.currentValue=u.slice()):"radio"===i&&u&&"object"==typeof u&&Object.keys(u).length?(c.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(u.value)){t.checked=!0;const e=t.closest("[c-field]");e&&l&&e.classList.add(l);const n=e&&e.querySelector("[c-label]");n&&a&&n.classList.add(a)}})),o.currentValue=u):o.currentValue="checkbox"===i?[]:{}}(c),i(c)}(o)}catch(t){console.error("Error building component",o.getAttribute("component-id"),t)}})),document.dispatchEvent(new Event("options-builder-ready"))}function r(t,e,n,o){const r={componentId:e.componentId,jsonPath:e.jsonPath,type:t,value:o.value,label:o.label,id:o.id,isChecked:o.isChecked,currentValue:o.currentValue};document.dispatchEvent(new CustomEvent("option-change",{detail:r})),"checkbox"===t?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:r})):"radio"===t&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:r}))}function i(t){const e=n.get(t);if(!e||!e.continueButtonId)return;const o=document.getElementById(e.continueButtonId);if(!o)return;const r=e.hiddenEl.value;"[]"===r||"{}"===r||"string"==typeof r&&""===r.trim()?o.classList.add("inutil"):o.classList.remove("inutil")}function c(){o()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),window.__OptionsBuilder={COMPONENTS:n}}();