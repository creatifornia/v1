!function(){"use strict";function e(e,t=null){try{return JSON.parse(e)}catch{return t}}function t(e,t){if(e&&t)return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e)}const o=new Map;function n(e,t,o,n){const r={componentId:t.componentId,jsonPath:t.jsonPath,type:e,value:n.value,label:n.label,id:n.id,isChecked:n.isChecked,currentValue:n.currentValue};document.dispatchEvent(new CustomEvent("option-change",{detail:r})),"checkbox"===e?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:r})):"radio"===e&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:r}))}document.addEventListener("data-ready",(function(){document.querySelectorAll("[component-id]").forEach((r=>{try{!function(r){const l=r.getAttribute("component-id"),c=r.getAttribute("storage-key"),i=r.getAttribute("storage-path"),a=r.getAttribute("json-path"),s=r.getAttribute("parent")||"",u="true"===r.getAttribute("has-deps"),d=r.getAttribute("value-key"),p=r.getAttribute("label-key"),b=r.getAttribute("tag-key"),g=r.getAttribute("id-key"),h=r.getAttribute("click-key")||"",f=r.getAttribute("f-class")||"",y=r.getAttribute("l-class")||"",v=r.getAttribute("continue-button-id")||null,m=r.getAttribute("checkbox-limit")?parseInt(r.getAttribute("checkbox-limit")):null,A=(r.getAttribute("input-type")||"checkbox").toLowerCase(),S=r.getAttribute("group-component-id")||l;if(!(l&&c&&i&&a&&d&&p))return void console.error(`component "${l}": faltan atributos requeridos.`);const k=r.querySelector('[role="group"]');if(!k)return void console.error(`component "${l}": falta elemento con role="group".`);const E=r.querySelector("[c-field]");if(!E)return void console.error(`component "${l}": falta plantilla [c-field].`);const C=e(localStorage.getItem(c),null);if(!C)return void console.warn(`component "${l}": no hay datos válidos en localStorage["${c}"].`);const q=t(C,`${i}.options`);if(!Array.isArray(q)||0===q.length)return void console.warn(`component "${l}": no se encontró ${i}.options o está vacío.`);let x=r.querySelector(`input[type="hidden"][cf-json-path="${a}"]`);x||(x=document.createElement("input"),x.type="hidden",x.setAttribute("cf-json-path",a),x.name=a,r.appendChild(x));null!=v&&x.setAttribute("continue-trigger",v);if(s)x.removeAttribute("data-required");else{x.setAttribute("data-required","");const e=t(C,`${i}.message`)||"Selecciona una opción";x.setAttribute("data-required-message",e)}x.value="checkbox"===A?x.value||"[]":x.value||"{}";for(;k.firstChild;)k.removeChild(k.firstChild);q.forEach((e=>{const t=E.cloneNode(!0),o=t.querySelector("[c-tag]"),n=t.querySelector("[c-label]"),r=t.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),c=String(e[p]??""),i=String(e[b]??"").trim(),a=String(e[d]??""),s=g&&void 0!==e[g]?String(e[g]):null,u=h&&void 0!==e[h]?String(e[h]):null;n&&(n.textContent=c),o&&(i?(o.textContent=i,o.style.display=""):(o.textContent="",o.style.display="none")),r?(r.type=A,r.setAttribute("data-opt-value",a),r.setAttribute("data-opt-label",c),s&&r.setAttribute("data-opt-id",s),i&&r.setAttribute("data-opt-tag",i),u&&r.setAttribute("data-opt-click",u),"radio"===A&&(r.name=S)):console.warn(`component "${l}": clone c-field no contiene native-button ni input detectable.`),u&&t.setAttribute("cl",u),k.appendChild(t)})),k._hasDelegate||(k.addEventListener("change",(t=>function(t,r){const l=t.target;if(!(l&&l instanceof HTMLInputElement))return;const c=o.get(r);if(!c)return;const{inputType:i,hiddenEl:a,checkboxLimit:s,fClass:u,lClass:d,groupEl:p}=c,b=l.getAttribute("data-opt-value"),g=l.getAttribute("data-opt-label")||"",h=l.getAttribute("data-opt-id")||null,f=l.checked;if("checkbox"===i){let t=e(a.value,[]);t=Array.isArray(t)?t:[];const o=t.some((e=>String(e.value)===String(b)));if(f&&!o){if(s&&t.length>=s)return y=`Selecciona máximo ${s} opciones.`,"function"==typeof showToast?showToast(y,"error"):"function"==typeof alert?alert(y):console.error(y),void(l.checked=!1);const e={value:b,label:g};h&&(e.id=h),t.push(e)}else!f&&o&&(t=t.filter((e=>String(e.value)!==String(b))));const r=l.closest("[c-field]");r&&u&&r.classList.toggle(u,f);const i=r&&r.querySelector("[c-label]");i&&d&&i.classList.toggle(d,f),a.value=JSON.stringify(t),c.currentValue=t.slice(),n("checkbox",c,l,{value:b,label:g,id:h,isChecked:f,currentValue:t})}else if("radio"===i){const e={value:b,label:g};h&&(e.id=h),p.querySelectorAll("[c-field]").forEach((e=>{u&&e.classList.remove(u);const t=e.querySelector("[c-label]");t&&d&&t.classList.remove(d)}));const t=l.closest("[c-field]");t&&u&&t.classList.add(u);const o=t&&t.querySelector("[c-label]");o&&d&&o.classList.add(d),a.value=JSON.stringify(e),c.currentValue=Object.assign({},e),n("radio",c,l,{value:b,label:g,id:h,isChecked:!0,currentValue:c.currentValue})}var y}(t,l))),k._hasDelegate=!0);o.set(l,{componentId:l,componentEl:r,storageKey:c,storagePath:i,jsonPath:a,parent:s,hasDeps:u,valueKey:d,labelKey:p,tagKey:b,idKey:g,clickKey:h,fClass:f,lClass:y,checkboxLimit:m,inputType:A,groupEl:k,fieldTemplate:E,hiddenEl:x,currentValue:"checkbox"===A?[]:{}}),function(t){const n=o.get(t);if(!n)return;const{hiddenEl:r,inputType:l,groupEl:c,fClass:i,lClass:a}=n,s=r.value;if(!s)return;const u=e(s,null);c.querySelectorAll("[c-field]").forEach((e=>{i&&e.classList.remove(i);const t=e.querySelector("[c-label]");t&&a&&t.classList.remove(a);const o=e.querySelector("[native-button], input");o&&(o.checked=!1)})),"checkbox"===l&&Array.isArray(u)?(u.forEach((e=>{c.querySelectorAll("[native-button], input").forEach((t=>{if(String(t.getAttribute("data-opt-value"))===String(e.value)){t.checked=!0;const e=t.closest("[c-field]");e&&i&&e.classList.add(i);const o=e&&e.querySelector("[c-label]");o&&a&&o.classList.add(a)}}))})),n.currentValue=u.slice()):"radio"===l&&u&&"object"==typeof u&&Object.keys(u).length?(c.querySelectorAll("[native-button], input").forEach((e=>{if(String(e.getAttribute("data-opt-value"))===String(u.value)){e.checked=!0;const t=e.closest("[c-field]");t&&i&&t.classList.add(i);const o=t&&t.querySelector("[c-label]");o&&a&&o.classList.add(a)}})),n.currentValue=u):n.currentValue="checkbox"===l?[]:{}}(l)}(r)}catch(e){console.error("Error building component",r.getAttribute("component-id"),e)}})),document.dispatchEvent(new Event("options-builder-ready"))})),window.__OptionsBuilder={COMPONENTS:o}}();