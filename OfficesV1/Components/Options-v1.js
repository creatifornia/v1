function buildOptionGroups(){document.querySelectorAll("[cf-options-build]").forEach((t=>{const e=t.getAttribute("cf-options-build"),o=t.getAttribute("cf-options-type")||"checkbox",i=t.getAttribute("cf-options-key"),n=`${t.getAttribute("cf-options-path")}.options`,r=t.getAttribute("cf-options-path"),c=t.getAttribute("cf-options-active")||"is-active-inputactive",a=t.getAttribute("cf-checkbox-limit"),s=t.getAttribute("cf-required"),u=`${i}.${t.getAttribute("cf-options-path")}.message`,p=t.getAttribute("cf-value-key")||"value",l=t.getAttribute("cf-tag-key")||"tag",d=t.getAttribute("cf-label-key")||"label",b=t.getAttribute("submit-json-path");let f="Select an option";if(u){const[t,...e]=u.split(".");if(t&&e.length>0)try{const o=JSON.parse(localStorage.getItem(t));f=e.reduce(((t,e)=>t?.[e]),o)||"Select one option"}catch{f="Select one option"}}const A=t.hasAttribute("cf-options-parent"),g=t.hasAttribute("cf-options-child"),h=t.getAttribute("cf-options-child")||"",y=t.getAttribute("cf-options-target")||"",m=p,v=d,S="id",k=l,q=document.querySelector(`[data-options-component="${e}"]`);if(!q)return void console.error(`Template no encontrado: data-options-component="${e}"`);const $=q.querySelector("[data-options-group]"),x=q.querySelector("[data-options-field]");if(!$||!x)return void console.error("La plantilla necesita [data-options-group] y [data-options-field]");let E;try{E=JSON.parse(localStorage.getItem(i))}catch{return void console.warn(`Datos inválidos en localStorage["${i}"]`)}const C=n.split(".").reduce(((t,e)=>t?.[e]),E);if(!Array.isArray(C)||0===C.length)return void console.warn(`Lista no encontrada en ${i} → ${n}`);const L=$.cloneNode(!1);L.setAttribute("data-options-group",""),L.setAttribute("group-id",r),y&&t.setAttribute("cf-options-target",y);const N=document.createElement("input");N.type="hidden",N.setAttribute("cf-json-path",b||r),N.setAttribute("name",n),N.setAttribute("data-required-message",f),"checkbox"===o&&a&&N.setAttribute("cf-checkbox-limit",a),g&&N.setAttribute("cf-options-display-input",h),A&&"true"===s&&N.setAttribute("data-required",""),N.value="checkbox"===o?"[]":"",L.appendChild(N),C.forEach((e=>{const i=x.cloneNode(!0);i.classList.remove(c);const a=i.querySelector("[data-options-button]"),s=i.querySelector("[data-options-label]"),u=i.querySelector("[label-tag]");if(a&&s){if(a.type=o,a.setAttribute("cf-options-value",e[m]),a.setAttribute("cf-options-label",e[v]),e[S]&&a.setAttribute("cf-options-id",e[S]),a.setAttribute("cf-options-path",b||r),a.setAttribute("cf-options-active",c),a.setAttribute("name","radio"===o?n:""),A&&a.setAttribute("cf-options-parent",t.getAttribute("cf-options-parent")),e.click?.trim()&&a.setAttribute("cl",e.click),s.textContent=e[v],u){const t=e[k]?.trim()||"";u.textContent=t,u.style.display=t?"block":"none"}L.appendChild(i)}})),t.appendChild(L)})),document.querySelectorAll("[data-options-component]").forEach((t=>{t.style.display="none"})),document.dispatchEvent(new Event("options-builder-ready"))}document.addEventListener("data-ready",buildOptionGroups);