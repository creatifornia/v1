!function(){"use strict";function e(e,t=null){try{return JSON.parse(e)}catch{return t}}function t(e,t){if(e&&t)return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:void 0),e)}const o=new Map;function n(){document.querySelectorAll("[component-id]").forEach((n=>{try{!function(n){const l=n.getAttribute("component-id"),a=n.getAttribute("storage-key"),i=n.getAttribute("storage-path"),s=n.getAttribute("json-path"),u=n.getAttribute("parent")||"",d="true"===n.getAttribute("has-deps"),p=n.getAttribute("value-key"),h=n.getAttribute("label-key"),b=n.getAttribute("tag-key"),g=n.getAttribute("id-key"),f=n.getAttribute("f-class")||"",y=n.getAttribute("l-class")||"",v=n.getAttribute("continue-button-id")||null,m=n.getAttribute("checkbox-limit")?parseInt(n.getAttribute("checkbox-limit")):null,A=(n.getAttribute("input-type")||"checkbox").toLowerCase(),S=n.getAttribute("group-component-id")||l;if(!(l&&a&&i&&s&&p&&h))return void console.error(`component "${l}": faltan atributos requeridos (component-id, storage-key, storage-path, json-path, value-key, label-key).`);const E=n.querySelector('[role="group"]');if(!E)return void console.error(`component "${l}": falta elemento con role="group".`);const k=n.querySelector("[c-field]");if(!k)return void console.error(`component "${l}": falta plantilla c-field dentro del componente.`);const q=e(localStorage.getItem(a),null);if(!q)return void console.warn(`component "${l}": no hay datos válidos en localStorage["${a}"].`);const C=t(q,`${i}.options`);if(!Array.isArray(C)||0===C.length)return void console.warn(`component "${l}": lista de opciones vacía o no encontrada en ${a} -> ${i}.options`);let L=n.querySelector(`input[type="hidden"][cf-json-path="${s}"]`);L||(L=document.createElement("input"),L.type="hidden",L.setAttribute("cf-json-path",s),L.name=s,n.appendChild(L));if(u)L.removeAttribute("data-required");else{L.setAttribute("data-required","");const e=t(q,`${i}.message`)||"Selecciona una opción";L.setAttribute("data-required-message",e)}L.value="checkbox"===A?L.value||"[]":L.value||"{}";for(;E.firstChild;)E.removeChild(E.firstChild);C.forEach((e=>{const t=k.cloneNode(!0),o=t.querySelector("[c-tag]"),n=t.querySelector("[c-label]"),r=t.querySelector('[native-button], input[type="checkbox"], input[type="radio"], input'),c=String(e[h]??"");n&&(n.textContent=c);const a=String(e[b]??"").trim();o&&(a?(o.textContent=a,o.style.display=""):(o.textContent="",o.style.display="none")),r?(r.type=A,r.setAttribute("data-opt-value",String(e[p]??"")),g&&void 0!==e[g]&&r.setAttribute("data-opt-id",String(e[g])),r.setAttribute("data-opt-label",c),r.setAttribute("data-opt-tag",a),"radio"===A&&(r.name=S)):console.warn(`component "${l}": c-field no contiene native-button ni input detectable.`),E.appendChild(t)})),E._hasDelegate||(E.addEventListener("change",(e=>function(e,t){const n=e.target;if(!(n&&n instanceof HTMLInputElement))return;const l=o.get(t);if(!l)return;const{inputType:a,hiddenEl:i,checkboxLimit:s,fClass:u,lClass:d,groupEl:p}=l,h=n.getAttribute("data-opt-value"),b=n.getAttribute("data-opt-label")||"",g=n.getAttribute("data-opt-id")||null,f=n.checked;if("checkbox"===a){let e;try{e=JSON.parse(i.value||"[]")}catch{e=[]}e=Array.isArray(e)?e:[];const t=e.some((e=>String(e.value)===String(h)));if(f&&!t){if(s&&e.length>=s)return y=`Selecciona máximo ${s} opciones.`,"function"==typeof showToast?showToast(y,"error"):"function"==typeof alert?alert(y):console.error(y),void(n.checked=!1);const t={value:h,label:b};g&&(t.id=g),e.push(t)}else!f&&t&&(e=e.filter((e=>String(e.value)!==String(h))));const o=n.closest("[c-field]");o&&u&&o.classList.toggle(u,f);const c=o&&o.querySelector("[c-label]");c&&d&&c.classList.toggle(d,f),i.value=JSON.stringify(e),l.currentValue=e.slice(),r("checkbox",l,n,{value:h,label:b,id:g,isChecked:f,currentValue:e})}else if("radio"===a){const e={value:h,label:b};g&&(e.id=g),p.querySelectorAll("[c-field]").forEach((e=>{u&&e.classList.remove(u);const t=e.querySelector("[c-label]");t&&d&&t.classList.remove(d)}));const t=n.closest("[c-field]");t&&u&&t.classList.add(u);const o=t&&t.querySelector("[c-label]");o&&d&&o.classList.add(d),i.value=JSON.stringify(e),l.currentValue=Object.assign({},e),r("radio",l,n,{value:h,label:b,id:g,isChecked:!0,currentValue:l.currentValue})}var y;l.hasDeps&&function(e,t,n){document.querySelectorAll(`[display-depend="${e}"]`).forEach((e=>{e.getAttribute("match")===String(t)?e.style.display="":e.style.display="none"})),document.querySelectorAll(`[required-depend="${e}"]`).forEach((e=>{const n=e.getAttribute("match"),r=e.querySelectorAll("input[cf-json-path]");n===String(t)?r.forEach((e=>e.setAttribute("data-required",""))):r.forEach((e=>{e.removeAttribute("data-required");const t=e.closest("[component-id]");if(t){const n=t.getAttribute("component-id"),r=o.get(n);r&&("checkbox"===r.inputType?(e.value="[]",r.currentValue=[],r.groupEl.querySelectorAll("[native-button], input").forEach((e=>e.checked=!1)),r.groupEl.querySelectorAll("[c-field]").forEach((e=>{r.fClass&&e.classList.remove(r.fClass);const t=e.querySelector("[c-label]");t&&r.lClass&&t.classList.remove(r.lClass)}))):(e.value="{}",r.currentValue={},r.groupEl.querySelectorAll("[native-button], input").forEach((e=>e.checked=!1)),r.groupEl.querySelectorAll("[c-field]").forEach((e=>{r.fClass&&e.classList.remove(r.fClass);const t=e.querySelector("[c-label]");t&&r.lClass&&t.classList.remove(r.lClass)}))))}else try{const t=JSON.parse(e.value||"");Array.isArray(t)?e.value="[]":e.value="{}"}catch{e.value="[]"}}))}))}(l.componentId,h);c(t)}(e,l))),E._hasDelegate=!0);o.set(l,{componentId:l,componentEl:n,storageKey:a,storagePath:i,jsonPath:s,parent:u,hasDeps:d,valueKey:p,labelKey:h,tagKey:b,idKey:g,fClass:f,lClass:y,continueButtonId:v,checkboxLimit:m,inputType:A,groupEl:E,fieldTemplate:k,hiddenEl:L,currentValue:"checkbox"===A?[]:{}}),function(t){const n=o.get(t);if(!n)return;const{hiddenEl:r,inputType:c,groupEl:l,fClass:a,lClass:i}=n,s=r.value;if(!s)return;const u=e(s,null);l.querySelectorAll("[c-field]").forEach((e=>{a&&e.classList.remove(a);const t=e.querySelector("[c-label]");t&&i&&t.classList.remove(i);const o=e.querySelector("[native-button], input");o&&(o.checked=!1)})),"checkbox"===c&&Array.isArray(u)?(u.forEach((e=>{l.querySelectorAll("[native-button], input").forEach((t=>{if(t.getAttribute("data-opt-value")==e.value){t.checked=!0;const e=t.closest("[c-field]");e&&a&&e.classList.add(a);const o=e&&e.querySelector("[c-label]");o&&i&&o.classList.add(i)}}))})),n.currentValue=u.slice()):"radio"===c&&u&&"object"==typeof u&&Object.keys(u).length?(l.querySelectorAll("[native-button], input").forEach((e=>{if(e.getAttribute("data-opt-value")==u.value){e.checked=!0;const t=e.closest("[c-field]");t&&a&&t.classList.add(a);const o=t&&t.querySelector("[c-label]");o&&i&&o.classList.add(i)}})),n.currentValue=u):n.currentValue="checkbox"===c?[]:{}}(l),c(l)}(n)}catch(e){console.error("Error building component",n.getAttribute("component-id"),e)}})),document.dispatchEvent(new Event("inputs-ready"))}function r(e,t,o,n){const r={componentId:t.componentId,jsonPath:t.jsonPath,type:e,value:n.value,label:n.label,id:n.id,isChecked:n.isChecked,currentValue:n.currentValue};document.dispatchEvent(new CustomEvent("option-change",{detail:r})),"checkbox"===e?document.dispatchEvent(new CustomEvent("valid-change-checkbox",{detail:r})):"radio"===e&&document.dispatchEvent(new CustomEvent("valid-change-radio",{detail:r}))}function c(e){const t=o.get(e);if(!t||!t.continueButtonId)return;const n=document.getElementById(t.continueButtonId);if(!n)return;const r=t.hiddenEl.value;"[]"===r||"{}"===r||"string"==typeof r&&""===r.trim()?(n.classList.add("inutil"),document.dispatchEvent(new CustomEvent("continue-state-changed",{detail:{id:t.continueButtonId,enabled:!1}}))):(n.classList.remove("inutil"),document.dispatchEvent(new CustomEvent("continue-state-changed",{detail:{id:t.continueButtonId,enabled:!0}})))}document.addEventListener("data-ready",(function(){n()}))}();