function getCache(e,t){try{const r=JSON.parse(localStorage.getItem(e));return t.split(".").reduce(((e,t)=>e?.[t]),r)}catch(r){return void console.warn(`⚠️ Error accediendo a ${e}.${t}`)}}function buildKeywords(){document.querySelectorAll("[cf-keywords-build]").forEach((e=>{const t=e.getAttribute("cf-keywords-build"),r=e.getAttribute("form-path"),n=e.getAttribute("keywords-limit"),o=e.getAttribute("maxlength")||"256",d=e.getAttribute("cf-required"),i=getCache("dynamic","keywords"),c=getCache("dynamic","keywords-repeated"),a=getCache("dynamic","keywords-limit"),l=document.getElementById(t),s=e.getAttribute("continue");if(!l)return void console.error(`❌ No se encontró template con id="${t}"`);e.style.display="block",e.style.opacity="1",e.style.visibility="visible";const u=l.cloneNode(!0);u.removeAttribute("id"),u.style.display="block",e.appendChild(u);const y=u.querySelector("[words-group]"),g=y.querySelector("[word-button]").cloneNode(!0),p=u.querySelector("[text-field-container]"),b=p.querySelector("[keywords-input]"),h=p.querySelector("[add-button]");y.innerHTML="",b.setAttribute("maxlength",o);const m=document.createElement("input");m.type="hidden",m.setAttribute("cf-json-path",r),m.setAttribute("name",r),m.setAttribute("data-required-message",i),m.value="[]",s&&m.setAttribute("continue-trigger",s),"true"===d&&(m.setAttribute("data-required",""),m.setAttribute("always-required","")),e.insertBefore(m,u);let v=[];const w=()=>{m.value=JSON.stringify(v);const e=m.getAttribute("continue-trigger");e&&(console.log("keywords-updated: dispatching valid-change-hidden for",e),document.dispatchEvent(new CustomEvent("valid-change-hidden",{detail:{continueButtonId:e}}))),y.innerHTML="",v.forEach(((e,t)=>{const r=g.cloneNode(!0);r.querySelector("[generated-keyword]").textContent=e,r.addEventListener("click",(e=>{e.preventDefault(),v=v.filter(((e,r)=>r!==t)),w()})),y.appendChild(r)}))},f=()=>{const e=b.value.trim();e&&(n&&v.length>=parseInt(n)?showErrorModal(`${a} ${n}.`):v.includes(e)?showErrorModal(c):(v.push(e),b.value="",w()))};h.addEventListener("click",(e=>{e.preventDefault(),f()})),b.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),f())})),l.style.display="none",w()})),document.dispatchEvent(new Event("keywords-builder-ready"))}document.addEventListener("data-ready",buildKeywords);