document.addEventListener("DOMContentLoaded",(async()=>{const e=new URLSearchParams(window.location.search),o=e.get("code"),t=e.get("state");if(!o)return;if(sessionStorage.getItem("printify_code_sent"))return;const n="/oauth_states/accepted_0",r="post",a=localStorage.getItem("AuthToken");if(a&&"undefined"!=typeof xano){xano.setAuthToken(a);try{if("function"!=typeof xano[r])throw new Error(`❌ HTTP verb not supported: ${r}`);const e={code:o,state:t},a=await xano[r](n,e);if(console.log(`✅ ${r.toUpperCase()} to ${n}`),console.log("📦 Printify-accepted Response:",a),a.body?.redirect_url)return console.log("🔀 Redirecting a:",a.body.redirect_url),void(window.location.href=a.body.redirect_url);sessionStorage.setItem("printify_code_sent","true")}catch(e){console.error("❌ Error al enviar código a Xano:",e)}}else console.error("❌ No AuthToken or Xano instance found")}));