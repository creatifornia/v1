<!-------------------------ü¶ú Data ü¶ú-------------------------> 
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Data/offices.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Data/options.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Data/dynamic-text.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Data/translate.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Data/events-data.js" defer></script>


<!------------------------üê≥ Fill  üê≥ ------------------------>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Fill/fill-text.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Fill/fill-inputs.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Fill/direct-inputs.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Fill/events-fill.js" defer></script> //cambiar


<!------------------------üß± Builders üß±---------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Builders/options.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Builders/currency.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Builders/keywords.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Builders/url-friendly-v1.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Builders/events-builders.js" defer></script>


<!----------------------- ‚ö° Form ‚ö° ------------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Form/form-submit.js" defer></script>


<!------------------------üôâ Display üôâ ---------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Display/translation.js" defer></script> //cambiar
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Display/display.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Display/events-display-v1.js" defer></script>


<!------------------------üêá Handlers üêá---------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Handlers/options-handler.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Handlers/options-checkbox.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Handlers/options-radio.js" defer></script>


<!----------------------- üê¨ Tools üê¨ ------------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/loader.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/fill-specific-inputs.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/mirror-click-v3.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/modal-error.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/refresh.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/reload-form.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/universal-emojis.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/Tools/reset-tabs.js" defer></script>


<!----------------------- üê¨ .get('') üê¨ ---------------------->
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/window-data/DynamicText.js" defer></script>
<script src="https://cdn.jsdelivr.net/gh/creatifornia/v1@main/office/window-data/OfficesText.js" defer></script>


<!----------------------- üêû Uploadcare üêû  ------------------>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.css" />
<script type="module">
  import * as UC from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/file-uploader.min.js';
  import es from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/locales/file-uploader/es.js';
  import en from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/locales/file-uploader/en.js';

  // Funci√≥n para inicializar UploadCare con el locale correcto
  const initUploadCare = () => {
    try {
      const lang = window.OfficesText?.get('country.lang.ISO_639') || 'es'; // Safe access with optional chaining
      
      if (lang === 'es') {
        UC.defineLocale('es', es);
      } else {
        UC.defineLocale('en', en); // Default to English for any non-Spanish language
      }

      UC.defineComponents(UC);
    } catch (error) {
      console.error('Error initializing UploadCare:', error);
      // Fallback to Spanish if any error occurs
      UC.defineLocale('es', es);
      UC.defineComponents(UC);
    }
  };

  // Esperar a que los textos din√°micos est√©n listos
  if (window.DynamicText && window.OfficesText) {
    document.addEventListener('dynamic_text-ready', initUploadCare);
  } else {
    // Cargar con valores por defecto si no existe el sistema de textos
    console.warn('DynamicText/OfficesText no disponibles, cargando UploadCare con espa√±ol por defecto');
    UC.defineLocale('es', es);
    UC.defineComponents(UC);
  }
</script>


<!------------------------üê∏ HTML üê∏-------------------------->
<!-- MODAL response error -->
<div id="error-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:#292626; padding:2rem; border-radius:1rem; max-width:400px; width:90%; text-align:center; color:#e7cfb1; font-family:sans-serif; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
      <h2 style="margin-bottom:1rem; font-size:18px;">üîî</h2> <!-- T√≠tulo m√°s peque√±o -->
      <p id="error-message" style="margin-bottom:2rem; font-size:20px; font-weight:bold;"></p> <!-- Mensaje m√°s grande -->
      <button onclick="closeErrorModal()" style="background:#e5813e; color:#292626; border:none; padding:0.75rem 1.5rem; border-radius:0.5rem; cursor:pointer; font-weight:bold;">
        Close
      </button>
    </div>
  </div>



  <script type="text/javascript">
  document.addEventListener("creatifornia-ready", fetchData);

  const CURRENT_DATA_VERSION = 'v1.0';

  function fetchData() {
    (async () => {
      const authToken = localStorage.getItem("AuthToken");
      const existingData = localStorage.getItem("data");
      
      // Verificar par√°metro de actualizaci√≥n
      const urlParams = new URLSearchParams(window.location.search);
      const forceRefresh = urlParams.has('update');
      
      if (forceRefresh && existingData) {
        console.log("üì¶ Data API by URL");
        localStorage.removeItem("data");
      }
      
      // Verificar cache
      if (existingData && !forceRefresh) {
        try {
          const parsedData = JSON.parse(existingData);
          if (parsedData.version === CURRENT_DATA_VERSION) {
            document.dispatchEvent(new Event("data-api-ready")); 
            console.log("üì¶ Data API");
            return;
          }
          localStorage.removeItem("data");
        } catch (e) {
          console.warn("Corrupted data, refreshing...");
          localStorage.removeItem("data");
        }
      }

      if (authToken) {
        xano.setAuthToken(authToken);
        
        try {
          const response = await xano.get('/data');
          if (response?.body) {
            // Funci√≥n para limpiar la estructura
            const cleanStructure = (data) => {
              if (Array.isArray(data)) {
                // Convertir array a objeto manteniendo las claves originales
                let result = {};
                data.forEach(item => {
                  if (typeof item === 'object' && item !== null) {
                    Object.keys(item).forEach(key => {
                      result[key] = cleanStructure(item[key]);
                    });
                  }
                });
                return result;
              } else if (typeof data === 'object' && data !== null) {
                let result = {};
                Object.keys(data).forEach(key => {
                  result[key] = cleanStructure(data[key]);
                });
                return result;
              }
              return data;
            };
            
            const cleanedData = cleanStructure(response.body);
            cleanedData.version = CURRENT_DATA_VERSION;
            
            localStorage.setItem("data", JSON.stringify(cleanedData));
            console.log(`üì¶ Data API (${CURRENT_DATA_VERSION})`);
            document.dispatchEvent(new Event("data-api-ready"));
          }
        } catch (error) {
          console.error("‚ùå Data fetch error:", error);
        }
      }
    })();
  }
</script>