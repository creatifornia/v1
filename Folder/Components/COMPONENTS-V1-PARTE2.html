<!-- continue -->
    <script>
    (function(){
    Â  'use strict';
    
    Â  // --- ConfiguraciÃ³n ---
    Â  const VALIDATION_DELAY = 120; // â±ï¸ Ajusta el delay en ms
    
    Â  // --- MÃ³dulo de validaciÃ³n ---
    Â  const ValidationModule = {
    Â  Â  isFieldEmpty: function(field) {
    Â  Â  Â  const rawValue = field.value;
    Â  Â  Â  
    Â  Â  Â  if (rawValue === '[]' || rawValue === '{}' || rawValue === 'null') return true;
    Â  Â  Â  
    Â  Â  Â  try {
    Â  Â  Â  Â  const parsed = JSON.parse(rawValue);
    Â  Â  Â  Â  if (Array.isArray(parsed) && parsed.length === 0) return true;
    Â  Â  Â  Â  if (typeof parsed === 'object' && Object.keys(parsed).length === 0) return true;
    Â  Â  Â  } catch (e) {
    Â  Â  Â  Â  return !rawValue || rawValue.trim() === '';
    Â  Â  Â  }
    Â  Â  Â  
    Â  Â  Â  return false;
    Â  Â  }
    Â  };
    
    Â  // --- Scroll hacia el botÃ³n ---
    Â  function scrollToButton(button) {
    Â  Â  if (!button) return;
    Â  Â  const rect = button.getBoundingClientRect();
    Â  Â  const isVisible = (rect.top >= 0 && rect.bottom <= window.innerHeight);
    Â  Â  
    Â  Â  // â­ Scroll suave solo si el botÃ³n no estÃ¡ visible en el viewport
    Â  Â  if (!isVisible) {
    Â  Â  Â  button.scrollIntoView({
    Â  Â  Â  Â  behavior: 'smooth',
    Â  Â  Â  Â  block: 'center'
    Â  Â  Â  });
    Â  Â  }
    Â  }
    
    Â  // --- Validar y actualizar botÃ³n ---
    Â  function validateContinueButton(buttonId) {
    Â  Â  if (!buttonId) return;
    
    Â  Â  const requiredFields = document.querySelectorAll(
    Â  Â  Â  `[continue-trigger="${buttonId}"][data-required]`
    Â  Â  );
    Â  Â  
    Â  Â  let allFilled = true;
    Â  Â  const validatedInputs = [];
    Â  Â  
    Â  Â  requiredFields.forEach(field => {
    Â  Â  Â  const isFilled = !ValidationModule.isFieldEmpty(field);
    Â  Â  Â  if (!isFilled) {
    Â  Â  Â  Â  allFilled = false;
    Â  Â  Â  }
    Â  Â  Â  validatedInputs.push({
    Â  Â  Â  Â  inputId: field.id || field.getAttribute('cf-json-path') || 'Sin ID',
    Â  Â  Â  Â  filled: isFilled
    Â  Â  Â  });
    Â  Â  });
    Â  Â  
    Â  Â  console.log(
    Â  Â  Â  `ðŸ“Š ValidaciÃ³n del botÃ³n "${buttonId}"`, 
    Â  Â  Â  {
    Â  Â  Â  Â  requiredInputsCount: requiredFields.length,
    Â  Â  Â  Â  validatedInputs: validatedInputs,
    Â  Â  Â  Â  allRequiredFilled: allFilled
    Â  Â  Â  }
    Â  Â  );
    Â  Â  
    Â  Â  const continueButton = document.getElementById(buttonId);
    Â  Â  if (!continueButton) return;
    Â  Â  
    Â  Â  continueButton.classList.toggle('inutil', !allFilled);
    Â  Â  continueButton.disabled = !allFilled;
    Â  Â  
    Â  Â  // â­ LÃ³gica para la clase 'has-new' y el scroll
    Â  Â  if (allFilled) {
    Â  Â  Â  if (!continueButton.classList.contains('has-new')) {
    Â  Â  Â  Â  continueButton.classList.add('has-new');
    Â  Â  Â  Â  scrollToButton(continueButton);
    Â  Â  Â  }
    Â  Â  } else {
    Â  Â  Â  continueButton.classList.remove('has-new');
    Â  Â  }
    Â  }
    
    Â  // --- Resetear botones ---
    Â  function resetContinueButtons(form) {
    Â  Â  const scope = form || document;
    Â  Â  const buttons = scope.querySelectorAll('[continue-target]');
    Â  Â  buttons.forEach(button => {
    Â  Â  Â  button.classList.add('inutil');
    Â  Â  Â  button.disabled = true;
    Â  Â  Â  // â­ Al resetear, tambiÃ©n quitar la clase 'has-new'
    Â  Â  Â  button.classList.remove('has-new');
    Â  Â  });
    Â  }
    Â  
    Â  // --- ConfiguraciÃ³n inicial de listeners para inputs de texto, etc. ---
    Â  document.addEventListener('DOMContentLoaded', () => {
    Â  Â  // Listener para inputs tradicionales
    Â  Â  const inputsToValidate = document.querySelectorAll(`input[cf-json-path][continue-trigger]:not([type="hidden"]), textarea[cf-json-path][continue-trigger]`);
    Â  Â  
    Â  Â  inputsToValidate.forEach(input => {
    Â  Â  Â  input.addEventListener('change', (e) => {
    Â  Â  Â  Â  const continueButtonId = e.target.getAttribute('continue-trigger');
    Â  Â  Â  Â  if (continueButtonId) {
    Â  Â  Â  Â  Â  document.dispatchEvent(new CustomEvent('valid-input-change', {
    Â  Â  Â  Â  Â  Â  detail: { continueButtonId: continueButtonId }
    Â  Â  Â  Â  Â  }));
    Â  Â  Â  Â  }
    Â  Â  Â  });
    Â  Â  });
    
    Â  Â  // ðŸš€ NUEVO: Listener para validaciÃ³n directa por clic ðŸš€
    Â  Â  const directValidationElements = document.querySelectorAll('[direct-validation]');
    Â  Â  directValidationElements.forEach(el => {
    Â  Â  Â  el.addEventListener('click', (e) => {
    Â  Â  Â  Â  const continueButtonId = e.currentTarget.getAttribute('direct-validation');
    Â  Â  Â  Â  if (continueButtonId) {
    Â  Â  Â  Â  Â  document.dispatchEvent(new CustomEvent('new-direct-validation', {
    Â  Â  Â  Â  Â  Â  detail: { continueButtonId: continueButtonId }
    Â  Â  Â  Â  Â  }));
    Â  Â  Â  Â  }
    Â  Â  Â  });
    Â  Â  });
    Â  Â  
    Â  Â  // Emitir evento de finalizaciÃ³n de configuraciÃ³n
    Â  Â  document.dispatchEvent(new Event('input-change-ready'));
    Â  });
    
    Â  // --- Escuchar eventos de validaciÃ³n ---
    Â  document.addEventListener('valid-change-checkbox', e => {
    Â  Â  if (!e.detail || !e.detail.continueButtonId) return;
    Â  Â  setTimeout(() => validateContinueButton(e.detail.continueButtonId), VALIDATION_DELAY);
    Â  });
    
    Â  document.addEventListener('valid-change-radio', e => {
    Â  Â  if (!e.detail || !e.detail.continueButtonId) return;
    Â  Â  setTimeout(() => validateContinueButton(e.detail.continueButtonId), VALIDATION_DELAY);
    Â  });
    Â  
    Â  document.addEventListener('valid-change-hidden', e => {
    Â  Â  if (!e.detail || !e.detail.continueButtonId) return;
    Â  Â  setTimeout(() => validateContinueButton(e.detail.continueButtonId), VALIDATION_DELAY);
    Â  });
    
    Â  document.addEventListener('valid-input-change', e => {
    Â  Â  if (!e.detail || !e.detail.continueButtonId) return;
    Â  Â  setTimeout(() => validateContinueButton(e.detail.continueButtonId), VALIDATION_DELAY);
    Â  });
    
    Â  document.addEventListener('new-direct-validation', e => {
    Â  Â  if (!e.detail || !e.detail.continueButtonId) return;
    Â  Â  setTimeout(() => validateContinueButton(e.detail.continueButtonId), VALIDATION_DELAY);
    Â  });
    
    Â  document.addEventListener('reset-continue-buttons', e => {
    Â  Â  resetContinueButtons(e.detail);
    Â  });
    })();
    </script>
    
    <!-- reset -->
    <script>
    (function () {
    Â  'use strict';
    
    Â  /* ---------- Utils ---------- */
    Â  function safeJSONParse(str, fallback = null) {
    Â  Â  try { return JSON.parse(str); } catch (e) { return fallback; }
    Â  }
    
    Â  function getInitialHiddenValue(inputType) {
    Â  Â  return inputType === 'checkbox' ? '[]' : '{}';
    Â  }
    
    Â  /* ---------- Clean deep components ---------- */
    Â  function cleanChildComponents(container) {
    Â  Â  if (!container || !(container instanceof Element)) return;
    
    Â  Â  // 1. Limpieza de elementos del Color Picker
    Â  Â  container.querySelectorAll('a[color-element-template]').forEach(el => {
    Â  Â  Â  console.debug('Reset: Simulating click on color picker element:', el);
    Â  Â  Â  el.click();
    Â  Â  });
    Â  Â  const selectColorBtn = container.querySelector('[internal-input-select-color]');
    Â  Â  if (selectColorBtn) {
    Â  Â  Â  selectColorBtn.style.borderColor = '';
    Â  Â  Â  selectColorBtn.style.color = '';
    Â  Â  Â  selectColorBtn.classList.remove('previewed');
    Â  Â  }
    
    Â  Â  // 2. Limpieza de elementos de Uploader de Uploadcare
    Â  Â  container.querySelectorAll('uc-file-item .uc-remove-btn').forEach(button => {
    Â  Â  Â  console.debug('Reset: Simulating click on Uploadcare remove button:', button);
    Â  Â  Â  button.click();
    Â  Â  });
    
    Â  Â  // 3. Limpieza de campos contenteditable
    Â  Â  container.querySelectorAll('[contenteditable="true"]').forEach(el => {
    Â  Â  Â  console.debug('Reset: Cleaning contenteditable element:', el);
    Â  Â  Â  el.innerHTML = '';
    Â  Â  });
    
    Â  Â  // 4. Limpieza de inputs nativos y hidden
    Â  Â  container.querySelectorAll('input, textarea, select').forEach(i => {
    Â  Â  Â  try {
    Â  Â  Â  Â  if (i instanceof HTMLInputElement && (i.type === 'checkbox' || i.type === 'radio')) {
    Â  Â  Â  Â  Â  i.checked = false;
    Â  Â  Â  Â  } else {
    Â  Â  Â  Â  Â  i.value = '';
    Â  Â  Â  Â  }
    Â  Â  Â  Â  if (i.selectedIndex !== undefined) try { i.selectedIndex = -1; } catch (e) {}
    Â  Â  Â  } catch (e) {}
    Â  Â  });
    
    Â  Â  container.querySelectorAll('[component-id] input[type="hidden"][cf-json-path]').forEach(h => {
    Â  Â  Â  try {
    Â  Â  Â  Â  const inputType = h.closest('[component-id]').getAttribute('input-type');
    Â  Â  Â  Â  h.value = getInitialHiddenValue(inputType);
    Â  Â  Â  } catch (e) {}
    Â  Â  });
    Â  Â  
    Â  Â  // 5. Limpieza general de clases de selecciÃ³n
    Â  Â  const buttonComponents = container.querySelectorAll('[component-id][input-type="checkbox"], [component-id][input-type="radio"]');
    Â  Â  buttonComponents.forEach(comp => {
    Â  Â  Â  const fieldClass = comp.getAttribute('f-class'); 
    Â  Â  Â  const labelClass = comp.getAttribute('l-class');
    Â  Â  Â  
    Â  Â  Â  if (fieldClass) { 
    Â  Â  Â  Â  comp.querySelectorAll(`.${fieldClass}`).forEach(el => el.classList.remove(fieldClass));
    Â  Â  Â  }
    Â  Â  Â  if (labelClass) {
    Â  Â  Â  Â  comp.querySelectorAll(`.${labelClass}`).forEach(el => el.classList.remove(labelClass));
    Â  Â  Â  }
    Â  Â  });
    Â  }
    
    Â  /* ---------- Reset whole form and dependencies ---------- */
    Â  function resetForm(formEl) {
    Â  Â  document.dispatchEvent(new CustomEvent('cf-loader-on'));
    Â  Â  
    Â  Â  // Limpieza completa de todos los campos y componentes dentro del formulario
    Â  Â  cleanChildComponents(formEl);
    
    Â  Â  // â­ NUEVO: Resetear el estado `active` en todos los componentes
    Â  Â  const allActiveElements = formEl.querySelectorAll('[active="true"]');
    Â  Â  allActiveElements.forEach(el => {
    Â  Â  Â  el.setAttribute('active', 'false');
    Â  Â  });
    
    Â  Â  // Oculta todos los elementos con display-depend
    Â  Â  formEl.querySelectorAll('[display-depend]').forEach(node => {
    Â  Â  Â  node.style.display = 'none';
    Â  Â  });
    
    Â  Â  // Elimina data-required de todos los inputs, excepto los marcados con always-required
    Â  Â  const allInputs = formEl.querySelectorAll('input, textarea, select');
    Â  Â  allInputs.forEach(h => {
    Â  Â  Â  // â­ MODIFICACIÃ“N CLAVE: usar hasAttribute() en lugar de getAttribute()
    Â  Â  Â  const alwaysReq = h.hasAttribute('always-required');
    Â  Â  Â  if (!alwaysReq) {
    Â  Â  Â  Â  h.removeAttribute('data-required');
    Â  Â  Â  }
    Â  Â  });
    
    Â  Â  // Reinicia el estado de los componentes
    Â  Â  const componentsToReset = formEl.querySelectorAll('[component-id]');
    Â  Â  componentsToReset.forEach(compEl => {
    Â  Â  Â  const inputType = compEl.getAttribute('input-type') || 'checkbox';
    Â  Â  Â  const jsonPath = compEl.getAttribute('json-path') || '';
    Â  Â  Â  const hiddenInput = compEl.querySelector(`input[cf-json-path="${jsonPath}"]`) || compEl.querySelector('input[type="hidden"][cf-json-path]');
    Â  Â  Â  
    Â  Â  Â  const detail = {
    Â  Â  Â  Â  componentId: compEl.getAttribute('component-id'),
    Â  Â  Â  Â  jsonPath: hiddenInput ? hiddenInput.getAttribute('cf-json-path') : null,
    Â  Â  Â  Â  type: inputType,
    Â  Â  Â  Â  value: null,
    Â  Â  Â  Â  label: '',
    Â  Â  Â  Â  id: null,
    Â  Â  Â  Â  isChecked: false,
    Â  Â  Â  Â  currentValue: null
    Â  Â  Â  };
    
    Â  Â  Â  document.dispatchEvent(new CustomEvent('option-change', { detail }));
    Â  Â  Â  if (inputType === 'checkbox') document.dispatchEvent(new CustomEvent('valid-change-checkbox', { detail }));
    Â  Â  Â  else if (inputType === 'radio') document.dispatchEvent(new CustomEvent('valid-change-radio', { detail }));
    Â  Â  });
    
    Â  Â  setTimeout(() => {
    Â  Â  Â  document.dispatchEvent(new CustomEvent('cf-loader-off'));
    Â  Â  }, 120);
    Â  }
    
    Â  /* ---------- Instalar listeners ---------- */
    Â  function install() {
    Â  Â  const reloadEls = document.querySelectorAll('[cf-reload-form]');
    Â  Â  reloadEls.forEach(el => {
    Â  Â  Â  el.addEventListener('click', function (evt) {
    Â  Â  Â  Â  try { evt.preventDefault(); } catch (e) {}
    Â  Â  Â  Â  const form = el.closest('[cf-form-submit]') || null;
    Â  Â  Â  Â  document.dispatchEvent(new CustomEvent('reset-continue-buttons', { detail: form }));
    Â  Â  Â  Â  if (form) {
    Â  Â  Â  Â  Â  resetForm(form);
    Â  Â  Â  Â  }
    Â  Â  Â  });
    Â  Â  });
    Â  }
    
    Â  if (document.readyState === 'loading') {
    Â  Â  document.addEventListener('DOMContentLoaded', install);
    Â  } else {
    Â  Â  install();
    Â  }
    })();
    </script>