<!--------------------- üêû Uploadcare (init con data-ready) üêû --------------------->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.css" />

<script type="module">
  import * as UC from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/file-uploader.min.js';
  import es from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/locales/file-uploader/es.js';
  import en from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/locales/file-uploader/en.js';

  // Funci√≥n segura para leer localStorage.offices.path
  function getOffices(path) {
    try {
      const data = JSON.parse(localStorage.getItem("offices") || "{}");
      return path.split('.').reduce((acc, key) => acc?.[key], data);
    } catch (e) {
      console.error("‚ùå Error parsing offices from localStorage:", e);
      return null;
    }
  }

  // Esperamos a que est√© lista la data de offices
  document.addEventListener("data-ready", () => {
    try {
      const langISO = getOffices('lang.ISO_639');

      // decidir idioma seg√∫n condici√≥n
      let chosenLang;
      if (langISO === 'es') {
        UC.defineLocale('es', es);
        chosenLang = 'es';
      } else {
        UC.defineLocale('en', en);
        chosenLang = 'en';
      }

      // definir componentes
      UC.defineComponents(UC);

      // disparar evento confirmando init y el idioma elegido
      document.dispatchEvent(new CustomEvent('uploadcare-ready', {
        detail: { lang: chosenLang }
      }));
      console.log('üêû Uploadcare inicializado ‚Äî idioma:', chosenLang);
    } catch (error) {
      console.error('‚ùå Error initializing UploadCare:', error);

      // Fallback a espa√±ol
      UC.defineLocale('es', es);
      UC.defineComponents(UC);

      document.dispatchEvent(new CustomEvent('uploadcare-ready', {
        detail: { lang: 'es', error: true, message: error.message }
      }));
    }
  });
</script>


<script>
  // Escuchar cuando Uploadcare ya est√° inicializado con chosenLang
  document.addEventListener('uploadcare-ready', (e) => {
    const chosenLang = e.detail?.lang || 'es'; // fallback

    // Buscar todos los <uc-config> y asignarles el idioma elegido
    document.querySelectorAll('uc-config').forEach(cfg => {
      cfg.setAttribute('locale-name', chosenLang);
      console.log(`üåç uc-config (${cfg.getAttribute("ctx-name")}) configurado con locale=${chosenLang}`);
    });
  });
</script>