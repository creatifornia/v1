<!-- 🌍 Translate-Binding 🌍 -->
<script>
document.addEventListener('translate-data-ready', () => {

  // Función robusta para obtener datos desde localStorage
  function getCache(key, path = '') {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return undefined;

      const data = JSON.parse(raw);
      if (!path) return data;

      return path.split('.').reduce((acc, part) => acc?.[part], data);
    } catch (e) {
      console.warn(`⚠️ Error accediendo a ${key}${path ? '.' + path : ''}`);
      return undefined;
    }
  }

  // Función principal de traducción
  function applyTranslations() {
    try {
      const translateData = getCache('translate') || {};

      const elements = document.querySelectorAll('[cf]');

      elements.forEach(element => {
        const componentName = element.getAttribute('cf');
        if (translateData?.[componentName]) {
          const hasHTML = element.innerHTML.trim() !== element.textContent.trim();
          element[hasHTML ? 'innerHTML' : 'textContent'] = translateData[componentName];
        }
      });

      console.log("🌍 Translation Finished");
    } catch (error) {
      console.error('❌ Translation binding error:', error);
    }

    // Emitir evento final
    document.dispatchEvent(new Event('translation-finished'));
  }

  applyTranslations();
});

document.addEventListener('translate-not-needed', () => {
  document.dispatchEvent(new Event('translation-finished'));
  console.log("🌍 ES");
});
</script>
