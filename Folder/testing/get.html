<!-- ü¶ú #5 GET dynamic_text ü¶ú -->
<script type="text/javascript">

  document.addEventListener("creatifornia-ready", dynamicText);
  document.addEventListener("update-dynamic_text", dynamicText);


  function dynamicText() {
  const authToken = localStorage.getItem("AuthToken");
  
  // Funci√≥n para convertir array a objeto estructurado
  const transformOptions = (dynamicArray) => {
    return dynamicArray.reduce((acc, item) => {
      const key = Object.keys(item)[0];
      const value = item[key];
      
      // Si el valor es un string, lo asignamos directamente
      if (typeof value === 'string') {
        acc[key] = value;
      } 
      // Si es un objeto, lo fusionamos
      else if (typeof value === 'object' && value !== null) {
        acc[key] = { ...(acc[key] || {}), ...value };
      }
      
      return acc;
    }, {});
  };

  if (authToken) {
    xano.setAuthToken(authToken);
    
    (async () => {
      try {
        const offices = JSON.parse(localStorage.getItem("offices") || "{}");
        const lang = offices.country?.lang?.ISO_639;
        const countryCode = offices.country?.ISO_3166_1_alfa_2;                
        const apiUrl = `/dynamic_text?lang=${lang}&country=${countryCode}`;
        
        const response = await xano.get(apiUrl);
        if (response?.body) {
          // Aplicar transformaci√≥n
          const transformedOptions = transformOptions(response.body);
          
          localStorage.setItem("dynamic_text", JSON.stringify(transformedOptions));
          
          console.log("‚úÖ dynamic_text transformed and loaded:", transformedOptions);
          
          document.dispatchEvent(new Event("cf-dynamic_text-ready"));
        }
      } catch (error) {
        console.error("‚ùå dynamic_text error:", error);
      }
    })();
  }
}
</script>
