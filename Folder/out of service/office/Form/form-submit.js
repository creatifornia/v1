const ValidationModule={validateRequiredFields(e){const t=e.querySelectorAll("[data-required]");let o=!0;return t.forEach((e=>{const t=e.value;let r=!1;if("[]"===t||"{}"===t)r=!0;else try{const e=JSON.parse(t);(Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length)&&(r=!0)}catch(e){}if(!r){const e=t?.trim();r=!e}if(r){const t=e.getAttribute("data-required-message")||"Required*";showErrorModal(t),o=!1}})),o},validateCurrencyFields(e){const t=e.querySelectorAll('input[type="hidden"][data-min-amount]');let o=!0;for(const e of t)try{const t=JSON.parse(e.value),r=parseFloat(e.getAttribute("data-min-amount")),a=parseFloat(e.getAttribute("data-max-amount"));if(t.unit_amount<r){showErrorModal(e.getAttribute("data-min-message")),o=!1;break}if(t.unit_amount>a){showErrorModal(e.getAttribute("data-max-message")),o=!1;break}}catch(e){console.error("‚ùå Error validando campo monetario:",e),o=!1;break}return o}},DataBuilderModule={buildFormData(e,t){const o={form_id:t};return e.querySelectorAll("[cf-json-path][data-required]").forEach((e=>{const t=e.getAttribute("cf-json-path");if(!t)return;const r=this.extractFieldValue(e);this.setNestedProperty(o,t,r)})),o},extractFieldValue(e){const t=e.getAttribute("cf-direct-input");return null!==t?t:"checkbox"===e.type?e.checked:"radio"===e.type?e.checked?e.value:void 0:"SELECT"===e.tagName&&e.multiple?Array.from(e.selectedOptions).map((e=>e.value)):e.value},setNestedProperty(e,t,o){const r=t.split(".");let a=e;r.forEach(((e,t)=>{t===r.length-1?a[e]=o:(a[e]||(a[e]={}),a=a[e])}))}},FrontendUpdaterModule={updateLocalStorageFromField(e,t){const o=e.getAttribute("update-local-storage-key"),r=e.getAttribute("update-local-storage-path");if(o&&r)try{const e=this.getStoredData(o);this.updateStoredValue(e,r,t),localStorage.setItem(o,JSON.stringify(e)),console.log(`üíæ LocalStorage actualizado "${o}" ‚Üí`,e)}catch(e){console.warn(`‚ö†Ô∏è Error actualizando localStorage para "${o}"`,e)}},getStoredData(e){try{return JSON.parse(localStorage.getItem(e))||{}}catch(t){return console.warn(`‚ö†Ô∏è No se pudo parsear localStorage["${e}"], se usar√° objeto vac√≠o`),{}}},updateStoredValue(e,t,o){const r=t.split(".");let a=e;r.forEach(((e,t)=>{t===r.length-1?a[e]=o:(a[e]&&"object"==typeof a[e]||(a[e]={}),a=a[e])}))}},SubmissionModule={MAX_ATTEMPTS:8,RETRY_DELAY:22e3,async submitWithRetry({endpoint:e,verb:t,data:o,form:r},a=1){try{if(console.log(`üì§ Env√≠o intento #${a} a ${e}`,o),"function"!=typeof xano[t])throw new Error(`‚ùå HTTP verb not supported: ${t}`);const i=await xano[t](e,o);if(console.log("ü¶ú Response:",i),localStorage.getItem("uploadcare")&&(localStorage.removeItem("uploadcare"),console.log("üßπ Uploadcare removed")),this.handleResponseEvents(i),i?.body?.redirect_url)return void(window.location.href=i.body.redirect_url);if("retry"===i?.body)return console.warn("‚è≥ Respuesta 'retry' recibida. Reintentando en 22 segundos..."),void(a<this.MAX_ATTEMPTS?setTimeout((()=>this.submitWithRetry({endpoint:e,verb:t,data:o,form:r},a+1)),this.RETRY_DELAY):showErrorModal("Demasiados intentos. Intenta m√°s tarde."));console.log("‚úÖ Submit")}catch(t){console.error(`‚ùå Error en env√≠o a ${e}:`,t),showErrorModal("Error al enviar. Intenta m√°s tarde.")}finally{r.removeAttribute("data-submitting")}},handleResponseEvents(e){e?.body?.event&&document.dispatchEvent(new CustomEvent(e.body.event,{detail:e.body.data||{},bubbles:!0})),e?.body?.error&&showErrorModal(e.body.error)}},FormHandlerModule={initialize(e){e._submitHandler&&e.removeEventListener("submit",e._submitHandler),e._submitHandler=this.createSubmitHandler(e),e.addEventListener("submit",e._submitHandler)},createSubmitHandler(e){const t=e.getAttribute("cf-form-submit")||"unnamed_form",o=e.getAttribute("cf-endpoint")||"/default_endpoint",r=(e.getAttribute("cf-verb")||"patch").toLowerCase();return async a=>{if(a.preventDefault(),a.stopImmediatePropagation(),!ValidationModule.validateRequiredFields(e))return;if(!ValidationModule.validateCurrencyFields(e))return;if(!e.checkValidity())return void e.reportValidity();if(e.hasAttribute("data-submitting"))return void console.warn("‚è∏Ô∏è Formulario ya en proceso de env√≠o");e.setAttribute("data-submitting","true");const i=localStorage.getItem("AuthToken");if(!i||"undefined"==typeof xano)return console.error("‚ùå No AuthToken or Xano instance found"),void e.removeAttribute("data-submitting");xano.setAuthToken(i);const n=DataBuilderModule.buildFormData(e,t);await SubmissionModule.submitWithRetry({endpoint:o,verb:r,data:n,form:e})}}},InitializationModule={initializeAllForms(){document.querySelectorAll("[cf-form-submit]").forEach((e=>{FormHandlerModule.initialize(e)})),document.dispatchEvent(new Event("submit-ready"))},updateSingleForm(e){const t=e.detail?.formIdentifier;if(!t)return void console.error("‚ùå cf-update-form recibido sin formIdentifier");const o=document.querySelector(`[cf-form-submit="${t}"]`);o&&FormHandlerModule.initialize(o),console.log("‚úÖ Form updated")}};document.addEventListener("inputs-ready",InitializationModule.initializeAllForms),document.addEventListener("cf-update-form",InitializationModule.updateSingleForm);